<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Toronto Crime Data Frequency</title>
        <meta name="" content="">
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
        <link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet">
        <style type="text/css">
            #map {
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
            }
    
            #slider {
                width: 40%;
            }
    
            .map-overlay {
                position: absolute;
                background: rgba(255, 255, 250, 0.9);
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
                font-family: Arial, sans-serif;
                border-radius: 3px;
            }
    
            #features {
                left: 0;
                margin-left: 20px;
                top: 0;
                height: 120px;
                margin-top: 20px;
                width: 360px;
            }
    
            #legend {
                padding: 10px;
                line-height: 18px;
                height: 150px;
                margin-bottom: 40px;
                width: 100px;
                bottom: 0;
                right: 0;
                margin-right: 20px;
            }
    
            .legend-key {
                display: inline-block;
                border-radius: 20%;
                width: 10px;
                height: 10px;
                margin-right: 5px;
            }
    
            .mapboxgl-popup {
                max-width: 100px;
                font: 9px/10px 'Helvetica Neue', Arial, Helvetica, sans-serif;
                text-align: center;
                padding: 0;
                margin: 0;
            }
            
            .map-overlay- {
                position: absolute;
    /*            background: rgba(255, 255, 250, 0.9);*/
    /*            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);*/
                font-family: Arial, sans-serif;
                border-radius: 3px;
            }
    
            #total {
                left: 0;
                margin-left: 20px;
                bottom: 0;
    /*            height: 120px;*/
                margin-bottom: 40px;
                width: 360px;
    /*            color: #0f6de2;*/
                color: rgba(55, 142, 181, 1.0);
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            }
    
        </style>
    </head>

    <body data-new-gr-c-s-check-loaded="14.1060.0" data-gr-ext-installed>
            <div id="map" class="mapboxgl-map">
                <div class="mapboxgl-canary" style="visibility: hidden;"></div>
                <div class="mapboxgl-canvas-container mapboxgl-interactive mapboxgl-touch-drag-pan mapboxgl-touch-zoom-rotate">
                    <canvas class="mapboxgl-canvas" tabindex="0" aria-label="Map" role="region" width="150" height="944" style="width: 150px; height: 944px; cursor: default;"></canvas>
                </div>

                <div class="mapboxgl-control-container">
                    <div class="mapboxgl-ctrl-top-left"></div>
                    <div class="mapboxgl-ctrl-top-right"></div>
                    <div class="mapboxgl-ctrl-bottom-left">
                        <div class="mapboxgl-ctrl" style="display: block;">
                            <a class="mapboxgl-ctrl-logo mapboxgl-compact" target="_blank" rel="noopener nofollow" href="https://www.mapbox.com/" aria-label="Mapbox logo"></a>
                        </div>
                    </div>

                    <div class="mapboxgl-ctrl-bottom-right">
                        <div class="mapboxgl-ctrl mapboxgl-ctrl-attrib mapboxgl-compact">
                            <button class="mapboxgl-ctrl-attrib-button" title="Toggle attribution" aria-label="Toggle attribution"></button>
                            <div class="mapboxgl-ctrl-attrib-inner" role="list">
                                <a href="https://www.mapbox.com/about/maps/" target="_blank" title="Mapbox" aria-label="Mapbox" role="listitem">© Mapbox</a> 
                                <a href="https://www.openstreetmap.org/about/" target="_blank" title="OpenStreetMap" aria-label="OpenStreetMap" role="listitem">© OpenStreetMap</a> 
                                <a class="mapbox-improve-map" href="https://apps.mapbox.com/feedback/?owner=mengqingzhao&amp;id=ckoqcdvz57jo917o2jdq96bnq&amp;access_token=pk.eyJ1IjoibWVuZ3Fpbmd6aGFvIiwiYSI6ImNrbHloY2lvejFsdHAyd28zMnVwZGszaHcifQ.T8viEchUMVha2Cr2S8-1-Q" target="_blank" title="Map feedback" aria-label="Map feedback" role="listitem" rel="noopener nofollow">Improve this map</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
<!--  
            <div class="mapboxgl-popup mapboxgl-popup-anchor-right" style="max-width: 240px; transform: translate(-100%, -50%) translate(139px, 496px);">
                <div class="mapboxgl-popup-tip"></div>
                <div class="mapboxgl-popup-content">
                    <h3> Mount Pleasant East (99)</h3>
                    <p>4 cases in 2014</p>
                </div>
            </div>
-->  
            <center class="map-overlay" id="features">
                <h2>Toronto Crime Data</h2>
                <label id="year">2014</label>  
                <input id="slider" type="range" min="0" max="7" step="1" value="0">  
                <input id="auto" type="button" value="▶">
            </center>

            <div class="map-overlay" id="legend">
                <b>Cases / year</b>
                <div>
                    <span class="legend-key" style="background-color: rgb(255, 237, 160);"></span>
                    <span>0-20</span>
                </div>
                <div>
                    <span class="legend-key" style="background-color: rgb(254, 217, 118);"></span>
                    <span>20-40</span>
                </div>
                <div>
                    <span class="legend-key" style="background-color: rgb(254, 178, 76);"></span>
                    <span>40-60</span>
                </div>
                <div>
                    <span class="legend-key" style="background-color: rgb(253, 141, 60);"></span>
                    <span>60-100</span>
                </div>
                <div>
                    <span class="legend-key" style="background-color: rgb(252, 78, 42);"></span>
                    <span>100-150</span>
                </div>
                <div><span class="legend-key" style="background-color: rgb(227, 26, 28);"></span>
                    <span>150-200</span>
                </div>
                <div>
                    <span class="legend-key" style="background-color: rgb(189, 0, 38);"></span>
                    <span>200+</span>
                </div>
            </div>

           <div class="map-overlay-" id="total">
               <h1 id="total-1">2014</h1>
               <h2 id="total-2">Total number: 32,459</h2>
            </div>
        
            <script>
                mapboxgl.accessToken = 'pk.eyJ1IjoibWVuZ3Fpbmd6aGFvIiwiYSI6ImNrbHloY2lvejFsdHAyd28zMnVwZGszaHcifQ.T8viEchUMVha2Cr2S8-1-Q';
                var map = new mapboxgl.Map({
                    container: 'map', // container id
                    style: 'mapbox://styles/mengqingzhao/ckoqcdvz57jo917o2jdq96bnq', // replace this with your style URL
                    center: [-79.35, 43.719], // starting position [lng, lat]
                    zoom: 10.14, // starting zoom
                });
        
                map.on('load', function() {
                    map.getCanvas().style.cursor = 'default';
                    var years = ['2014', '2015', '2016', '2017', '2018', '2019', '2020','2021'];
                    var years_data = ['2014_data', '2015_data', '2016_data', '2017_data', '2018_data', '2019_data', '2020_data','2021_data'];
                    var total_data = ['32,459', '32,910', '33,596', '35,484', '37,408', '39,912', '34,866','33,685'];
                    var current = 0;
        
                    var legend = document.getElementById('legend');
                    var layers = ['0-20', '20-40', '40-60', '60-100', '100-150', '150-200', '200+']; // change the value
                    var colors = ['#FFEDA0', '#FED976', '#FEB24C', '#FD8D3C', '#FC4E2A', '#E31A1C', '#BD0026']; //change colors
                    for (i = 0; i < layers.length; i++) {
                        var layer = layers[i];
                        var color = colors[i];
                        var item = document.createElement('div');
                        var key = document.createElement('span');
                        key.className = 'legend-key';
                        key.style.backgroundColor = color;
        
                        var value = document.createElement('span');
                        value.innerHTML = layer;
                        item.appendChild(key);
                        item.appendChild(value);
                        legend.appendChild(item);
                    }
        
                    document.getElementById('slider')
                        .addEventListener('input', function(e) {
                            var year = parseInt(e.target.value, 10);
                            filterBy(year);
                        });
        
                    function filterBy(year) {
                        var newlayer = years[year];
                        //                var newlayer_data = years_data[year];
                        var visibility = map.getLayoutProperty(newlayer, 'visibility');
                        if ((year !== current) && visibility !== 'visible') {
                            map.setLayoutProperty(years[current], 'visibility', 'none');
                            //                    map.setLayoutProperty(years_data[current], 'visibility', 'none');
                            map.setLayoutProperty(newlayer, 'visibility', 'visible');
                            //                    map.setLayoutProperty(newlayer_data, 'visibility', 'visible');
                            current = year;
                        }
        
                        // Set the label to the year
                        document.getElementById('year').textContent = 'in ' + years[year];
                        document.getElementById('total-1').textContent = years[year];
                        document.getElementById('total-2').textContent = 'Total number: ' + total_data[year];
                    }
                    var clicked = 0;
                    var cnt;
                    document.getElementById('auto')
                        .addEventListener('click', function() {
                        if (clicked == 0){
                            clicked = 1;
                            document.getElementById('auto').value = "| |"
                            cnt = self.setInterval(function() {
                                var now = parseInt(document.getElementById('slider').value);
                                var t = now + 1;
                                if (t > 7) {
                                    t = 0;
                                }
                                document.getElementById('slider').value = t;
                                filterBy(t);
                            }, 1000);
                        }else{
                            cnt=window.clearInterval(cnt);
                            clicked = 0;
                            document.getElementById('auto').value = "▶"
                        }
                        }, false)
        
                    var popup = new mapboxgl.Popup({
                        //                        offset: [0, -15]
                        closeButton: false,
                        closeOnClick: false
                    })
                    map.on('mousemove', function(e) {
                        var boroughs = map.queryRenderedFeatures(e.point, {
                            layers: [years[current]]
                        });
                        if (boroughs.length > 0) {
                            map.setFilter('boundaries', ['==', ['get', 'AREA_SHORT_CODE'], boroughs[0].properties.Hood_ID]);
                            map.setLayoutProperty('boundaries', 'visibility', 'visible');
                            switch (current) {
                                case 0:
                                    popup.setLngLat(e.lngLat)
                                        .setHTML('<h3> ' + boroughs[0].properties.AREA_NAME + '</h3><p>' + boroughs[0].properties.Year_2014 + '</strong> cases in 2014</em></p>')
                                        .addTo(map);
                                    break;
                                case 1:
                                    popup.setLngLat(e.lngLat)
                                        .setHTML('<h3> ' + boroughs[0].properties.AREA_NAME + '</h3><p>' + boroughs[0].properties.Year_2015 + '</strong> cases in 2015</em></p>')
                                        .addTo(map);
                                    break;
                                case 2:
                                    popup.setLngLat(e.lngLat)
                                        .setHTML('<h3> ' + boroughs[0].properties.AREA_NAME + '</h3><p>' + boroughs[0].properties.Year_2016 + '</strong> cases in 2016</em></p>')
                                        .addTo(map);
                                    break;
                                case 3:
                                    popup.setLngLat(e.lngLat)
                                        .setHTML('<h3> ' + boroughs[0].properties.AREA_NAME + '</h3><p>' + boroughs[0].properties.Year_2017 + '</strong> cases in 2017</em></p>')
                                        .addTo(map);
                                    break;
                                case 4:
                                    popup.setLngLat(e.lngLat)
                                        .setHTML('<h3> ' + boroughs[0].properties.AREA_NAME + '</h3><p>' + boroughs[0].properties.Year_2018 + '</strong> cases in 2018</em></p>')
                                        .addTo(map);
                                    break;
                                case 5:
                                    popup.setLngLat(e.lngLat)
                                        .setHTML('<h3> ' + boroughs[0].properties.AREA_NAME + '</h3><p>' + boroughs[0].properties.Year_2019 + '</strong> cases in 2019</em></p>')
                                        .addTo(map);
                                    break;
                                case 6:
                                    popup.setLngLat(e.lngLat)
                                        .setHTML('<h3> ' + boroughs[0].properties.AREA_NAME + '</h3><p>' + boroughs[0].properties.Year_2020 + '</strong> cases in 2020</em></p>')
                                        .addTo(map);
                                    break;
                                case 7:
                                    popup.setLngLat(e.lngLat)
                                        .setHTML('<h3> ' + boroughs[0].properties.AREA_NAME + '</h3><p>' + boroughs[0].properties.Year_2021 + '</strong> cases in 2021</em></p>')
                                        .addTo(map);
                                    break;
                            }
                        } else {
                            popup.remove();
                            map.setLayoutProperty('boundaries', 'visibility', 'none');
                        }
                    });
                });
            </script>
    </body>
</html>